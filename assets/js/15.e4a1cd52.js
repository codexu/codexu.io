(window.webpackJsonp=window.webpackJsonp||[]).push([[15],{213:function(t,a,e){"use strict";e.r(a);var s=e(0),o=Object(s.a)({},function(){var t=this,a=t.$createElement,e=t._self._c||a;return e("ContentSlotsDistributor",{attrs:{"slot-key":t.$parent.slotKey}},[e("h1",{attrs:{id:"cookie就摆在那，为什么死活吃不到？"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#cookie就摆在那，为什么死活吃不到？","aria-hidden":"true"}},[t._v("#")]),t._v(" Cookie就摆在那，为什么死活吃不到？")]),t._v(" "),e("p",[e("img",{attrs:{src:"http://ww2.sinaimg.cn/large/006tNc79ly1g4elgmco0jj30b201eq2w.jpg",alt:""}})]),t._v(" "),e("p",[t._v("浏览器里明明存在的cookie，居然获取不到???")]),t._v(" "),e("div",{staticClass:"language-javascript extra-class"},[e("pre",{pre:!0,attrs:{class:"language-javascript"}},[e("code",[t._v("console"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),e("span",{pre:!0,attrs:{class:"token function"}},[t._v("log")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("document"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("cookie"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n"),e("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// 没有???")]),t._v("\n")])])]),e("p",[e("img",{attrs:{src:"http://ww3.sinaimg.cn/large/006tNc79ly1g4el31tek2j308c08it8t.jpg",alt:""}})]),t._v(" "),e("h2",{attrs:{id:"起因"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#起因","aria-hidden":"true"}},[t._v("#")]),t._v(" 起因")]),t._v(" "),e("p",[t._v("近来闲来无事，打算了解一下后端，既然想一探究竟，就从基本的注册登录开始做起。")]),t._v(" "),e("h2",{attrs:{id:"技术选型"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#技术选型","aria-hidden":"true"}},[t._v("#")]),t._v(" 技术选型")]),t._v(" "),e("p",[t._v("作为一名前端开发人员，用 Node.js 去体验后端应该是最快上手的方式了。看了一下文档，好长...没那么多时间看，直接...")]),t._v(" "),e("ul",[e("li",[t._v("框架 koa2")]),t._v(" "),e("li",[t._v("数据库 Mysql，不会操作数据库找到了 Sequelize")]),t._v(" "),e("li",[t._v("请求 Axios")])]),t._v(" "),e("h2",{attrs:{id:"思路"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#思路","aria-hidden":"true"}},[t._v("#")]),t._v(" 思路")]),t._v(" "),e("ul",[e("li",[t._v("账户密码，不做加密，直接明文。")]),t._v(" "),e("li",[t._v("登陆\n"),e("ul",[e("li",[t._v("使用 jwt (jsonwebtoken) 生成 token 。")]),t._v(" "),e("li",[t._v("使用 koa2 ctx.cookies.set 在后端设置 cookie ，保存 token 。")])])]),t._v(" "),e("li",[t._v("跨域请求 koa2-cors")])]),t._v(" "),e("h2",{attrs:{id:"问题来了"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#问题来了","aria-hidden":"true"}},[t._v("#")]),t._v(" 问题来了")]),t._v(" "),e("p",[e("strong",[t._v("问题一")]),t._v("：填好用户名密码，点击登录，浏览器中没有被设置 cookie")]),t._v(" "),e("p",[t._v("解决办法： 使用 Axios 请求时，增加属性 withCredentials: true，这样就请求就可以携带 cookie 了。")]),t._v(" "),e("p",[t._v("产生这种情况的原因是因为 koa2-cors，如果在前端使用代理跨域不会出现这种情况。")]),t._v(" "),e("p",[e("strong",[t._v("问题二")]),t._v("：浏览器中虽然能看到 cookie 中已经存在 token，但是前端代码中获取不到")]),t._v(" "),e("p",[t._v("解决办法：koa2 设置 cookie 时，设置 httpOnly: false 即可。")]),t._v(" "),e("h2",{attrs:{id:"查找原因"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#查找原因","aria-hidden":"true"}},[t._v("#")]),t._v(" 查找原因")]),t._v(" "),e("p",[t._v("doucment.cookie 无法获取到 cookie 是因为 同源策略 和 HttpOnly 标记的原因。")]),t._v(" "),e("p",[e("strong",[t._v("withCredentials")]),t._v("：表示跨域请求时是否需要使用凭证，默认是 false")]),t._v(" "),e("blockquote",[e("p",[t._v("MDN\nXMLHttpRequest.withCredentials 属性是一个 Boolean 类型，它指示了是否该使用类似 cookies,authorization headers(头部授权)或者TLS客户端证书这一类资格证书来创建一个跨站点访问控制（cross-site Access-Control）请求。在同一个站点下使用 withCredentials 属性是无效的。\n此外，这个指示也会被用做响应中 cookies 被忽视的标示。默认值是 false。\n如果在发送来自其他域的 XMLHttpRequest 请求之前，未设置 withCredentials 为true，那么就不能为它自己的域设置 cookie 值。而通过设置 withCredentials 为true获得的第三方 cookies，将会依旧享受同源策略，因此不能被通过 document.cookie 或者从头部相应请求的脚本等访问。")])]),t._v(" "),e("p",[e("strong",[t._v("httpOnly")]),t._v("：服务器可访问 cookie, 默认是 true")]),t._v(" "),e("blockquote",[e("p",[t._v("MDN\n为避免跨域脚本 (XSS) 攻击，通过JavaScript的 Document.cookie API无法访问带有 HttpOnly 标记的Cookie，它们只应该发送给服务端。如果包含服务端 Session 信息的 Cookie 不想被客户端 JavaScript 脚本调用，那么就应该为其设置 HttpOnly 标记。")])]),t._v(" "),e("p",[e("img",{attrs:{src:"http://ww1.sinaimg.cn/large/006tNc79ly1g4enfdahomj308c07975h.jpg",alt:""}})]),t._v(" "),e("h2",{attrs:{id:"换种方式"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#换种方式","aria-hidden":"true"}},[t._v("#")]),t._v(" 换种方式")]),t._v(" "),e("p",[t._v("MDN 上说 可能会 XSS 攻击，所以换种方式，存储到 localstorage 里吧。请求时，将 token 加在 header 中 Authorization。")]),t._v(" "),e("h2",{attrs:{id:"总结"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#总结","aria-hidden":"true"}},[t._v("#")]),t._v(" 总结")]),t._v(" "),e("p",[t._v("虽然绕了一圈，好像总结了两个没啥卵用的知识点，但是学习就是这样，遇到坑就积累一下。")]),t._v(" "),e("p",[t._v("希望有大佬能指点一下，如何做一个安全的登录。")])])},[],!1,null,null,null);a.default=o.exports}}]);